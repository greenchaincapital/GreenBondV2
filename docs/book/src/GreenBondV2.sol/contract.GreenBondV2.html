<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>GreenBondV2 - GreenBond Docs</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../book.css">

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item "><a href="../../index.html">Home</a></li><li class="chapter-item "><a href="../../TECH_OVERVIEW.html">Technical Overview</a></li><li class="chapter-item "><a href="../../PROJECT_FINANCE.html">Project Finance</a></li><li class="chapter-item "><a href="../../XSTRUCTURE.html">XStructure</a></li><li class="chapter-item "><a href="../../GOV.html">Green Governance</a></li><li class="chapter-item affix "><li class="part-title">src</li><li class="chapter-item "><a href="../../src/interfaces/index.html">❱ interfaces</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../src/interfaces/IL2Encoder.sol/interface.IL2Encoder.html">IL2Encoder</a></li><li class="chapter-item "><a href="../../src/interfaces/IL2Pool.sol/interface.IL2Pool.html">IL2Pool</a></li></ol></li><li class="chapter-item expanded "><a href="../../src/GreenBondV2.sol/contract.GreenBondV2.html" class="active">GreenBondV2</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">GreenBond Docs</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/greenchaincapital/GreenBondV2" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="greenbondv2"><a class="header" href="#greenbondv2">GreenBondV2</a></h1>
<p><a href="https://github.com/greenchaincapital/GreenBondV2/blob/51a1807f93a4bb92129f4cca023d319c78973c0c/src/GreenBondV2.sol">Git Source</a></p>
<p><strong>Inherits:</strong>
ERC4626</p>
<p><strong>Author:</strong>
@sandybradley</p>
<p>ERC4626 Vault on Arbitrum, wth USDT as asset and Aave as passive income lockup.
Active income is earned through project payouts, financed by deployed assets.
Time weighted asset lockup period of 3-6 months applies to enable the above.</p>
<h2 id="state-variables"><a class="header" href="#state-variables">State Variables</a></h2>
<h3 id="asset"><a class="header" href="#asset">ASSET</a></h3>
<p>USDT on arbitrum</p>
<pre><code class="language-solidity">ERC20 internal constant ASSET = ERC20(0xFd086bC7CD5C481DCC9C85ebE478A1C0b69FCbb9);
</code></pre>
<h3 id="aave_asset"><a class="header" href="#aave_asset">AAVE_ASSET</a></h3>
<p>aUSDT on arbitrum</p>
<pre><code class="language-solidity">ERC20 public constant AAVE_ASSET = ERC20(0x6ab707Aca953eDAeFBc4fD23bA73294241490620);
</code></pre>
<h3 id="pool"><a class="header" href="#pool">POOL</a></h3>
<p>Aave pool on arbitrum (proxy)</p>
<pre><code class="language-solidity">IL2Pool public constant POOL = IL2Pool(0x794a61358D6845594F94dc1DB02A252b5b4814aD);
</code></pre>
<h3 id="encoder"><a class="header" href="#encoder">ENCODER</a></h3>
<p>Aave encoder on arbitrum</p>
<pre><code class="language-solidity">IL2Encoder public constant ENCODER = IL2Encoder(0x9abADECD08572e0eA5aF4d47A9C7984a5AA503dC);
</code></pre>
<h3 id="lockup"><a class="header" href="#lockup">LOCKUP</a></h3>
<p>Deposit lockup time, default 3 months</p>
<pre><code class="language-solidity">uint64 public LOCKUP = 3 * 30 days;
</code></pre>
<h3 id="deployed_assets"><a class="header" href="#deployed_assets">DEPLOYED_ASSETS</a></h3>
<p>Transient tokens deployed to project (~ 6 months lock-up)</p>
<pre><code class="language-solidity">uint256 public DEPLOYED_ASSETS;
</code></pre>
<h3 id="total_deployed_assets"><a class="header" href="#total_deployed_assets">TOTAL_DEPLOYED_ASSETS</a></h3>
<p>Total assets deployed to projects</p>
<pre><code class="language-solidity">uint256 public TOTAL_DEPLOYED_ASSETS;
</code></pre>
<h3 id="total_repaid_assets"><a class="header" href="#total_repaid_assets">TOTAL_REPAID_ASSETS</a></h3>
<p>Total assets paid by projects</p>
<pre><code class="language-solidity">uint256 public TOTAL_REPAID_ASSETS;
</code></pre>
<h3 id="gov"><a class="header" href="#gov">GOV</a></h3>
<p>Governance addresses</p>
<pre><code class="language-solidity">mapping(address =&gt; bool) public GOV;
</code></pre>
<h3 id="deposittimestamps"><a class="header" href="#deposittimestamps">depositTimestamps</a></h3>
<p>Time weighted average lockup time per address</p>
<pre><code class="language-solidity">mapping(address =&gt; uint256) public depositTimestamps;
</code></pre>
<h3 id="projectcount"><a class="header" href="#projectcount">projectCount</a></h3>
<pre><code class="language-solidity">uint256 public projectCount;
</code></pre>
<h3 id="projects"><a class="header" href="#projects">projects</a></h3>
<pre><code class="language-solidity">mapping(uint256 =&gt; Project) public projects;
</code></pre>
<h3 id="rewards"><a class="header" href="#rewards">rewards</a></h3>
<pre><code class="language-solidity">mapping(address =&gt; uint256) internal rewards;
</code></pre>
<h3 id="lastclaimtimestamps"><a class="header" href="#lastclaimtimestamps">lastClaimTimestamps</a></h3>
<pre><code class="language-solidity">mapping(address =&gt; uint256) internal lastClaimTimestamps;
</code></pre>
<h2 id="functions"><a class="header" href="#functions">Functions</a></h2>
<h3 id="constructor"><a class="header" href="#constructor">constructor</a></h3>
<pre><code class="language-solidity">constructor() ERC4626(ASSET, &quot;GreenBondV2&quot;, &quot;gBOND2&quot;);
</code></pre>
<h3 id="_govcheck"><a class="header" href="#_govcheck">_govCheck</a></h3>
<pre><code class="language-solidity">function _govCheck() internal view;
</code></pre>
<h3 id="changelockup"><a class="header" href="#changelockup">changeLockup</a></h3>
<pre><code class="language-solidity">function changeLockup(uint64 newLockup) external;
</code></pre>
<h3 id="addgov"><a class="header" href="#addgov">addGov</a></h3>
<pre><code class="language-solidity">function addGov(address newGov) external;
</code></pre>
<h3 id="removegov"><a class="header" href="#removegov">removeGov</a></h3>
<pre><code class="language-solidity">function removeGov(address oldGov) external;
</code></pre>
<h3 id="recovertoken"><a class="header" href="#recovertoken">recoverToken</a></h3>
<pre><code class="language-solidity">function recoverToken(address token, address receiver, uint256 tokenAmount) external;
</code></pre>
<h3 id="registerproject"><a class="header" href="#registerproject">registerProject</a></h3>
<pre><code class="language-solidity">function registerProject(address projectAdmin, string calldata projectName) external returns (uint256);
</code></pre>
<h3 id="linkprojectagreement"><a class="header" href="#linkprojectagreement">linkProjectAgreement</a></h3>
<pre><code class="language-solidity">function linkProjectAgreement(uint256 projectId, string calldata masterAgreement) external;
</code></pre>
<h3 id="completeproject"><a class="header" href="#completeproject">completeProject</a></h3>
<pre><code class="language-solidity">function completeProject(uint256 projectId) external;
</code></pre>
<h3 id="payproject"><a class="header" href="#payproject">payProject</a></h3>
<pre><code class="language-solidity">function payProject(uint256 assets, uint256 projectId) external;
</code></pre>
<h3 id="receiveincome"><a class="header" href="#receiveincome">receiveIncome</a></h3>
<pre><code class="language-solidity">function receiveIncome(uint256 assets, uint256 projectId) external;
</code></pre>
<h3 id="totalassets"><a class="header" href="#totalassets">totalAssets</a></h3>
<pre><code class="language-solidity">function totalAssets() public view virtual override returns (uint256);
</code></pre>
<h3 id="deposit"><a class="header" href="#deposit">deposit</a></h3>
<pre><code class="language-solidity">function deposit(uint256 assets, address receiver) public virtual override returns (uint256 shares);
</code></pre>
<h3 id="mint"><a class="header" href="#mint">mint</a></h3>
<pre><code class="language-solidity">function mint(uint256 shares, address receiver) public virtual override returns (uint256 assets);
</code></pre>
<h3 id="withdraw"><a class="header" href="#withdraw">withdraw</a></h3>
<pre><code class="language-solidity">function withdraw(uint256 assets, address receiver, address owner) public virtual override returns (uint256 shares);
</code></pre>
<h3 id="redeem"><a class="header" href="#redeem">redeem</a></h3>
<pre><code class="language-solidity">function redeem(uint256 shares, address receiver, address owner) public virtual override returns (uint256 assets);
</code></pre>
<h3 id="transfer"><a class="header" href="#transfer">transfer</a></h3>
<pre><code class="language-solidity">function transfer(address to, uint256 amount) public virtual override returns (bool success);
</code></pre>
<h3 id="transferfrom"><a class="header" href="#transferfrom">transferFrom</a></h3>
<pre><code class="language-solidity">function transferFrom(address from, address to, uint256 amount) public virtual override returns (bool success);
</code></pre>
<h3 id="beforewithdraw"><a class="header" href="#beforewithdraw">beforeWithdraw</a></h3>
<pre><code class="language-solidity">function beforeWithdraw(uint256 assets, uint256) internal virtual override;
</code></pre>
<h3 id="afterdeposit"><a class="header" href="#afterdeposit">afterDeposit</a></h3>
<pre><code class="language-solidity">function afterDeposit(uint256 assets, uint256) internal virtual override;
</code></pre>
<h3 id="_updatedeposittimestamp"><a class="header" href="#_updatedeposittimestamp">_updateDepositTimestamp</a></h3>
<pre><code class="language-solidity">function _updateDepositTimestamp(address account, uint256 shares) internal;
</code></pre>
<h3 id="_updatetransfertimestamp"><a class="header" href="#_updatetransfertimestamp">_updateTransferTimestamp</a></h3>
<pre><code class="language-solidity">function _updateTransferTimestamp(address account, uint256 shares) internal;
</code></pre>
<h2 id="events"><a class="header" href="#events">Events</a></h2>
<h3 id="governoradded"><a class="header" href="#governoradded">GovernorAdded</a></h3>
<pre><code class="language-solidity">event GovernorAdded(address newGov);
</code></pre>
<h3 id="governorremoved"><a class="header" href="#governorremoved">GovernorRemoved</a></h3>
<pre><code class="language-solidity">event GovernorRemoved(address oldGov);
</code></pre>
<h3 id="paidproject"><a class="header" href="#paidproject">PaidProject</a></h3>
<pre><code class="language-solidity">event PaidProject(address admin, uint256 amount, uint256 projectId);
</code></pre>
<h3 id="receivedincome"><a class="header" href="#receivedincome">ReceivedIncome</a></h3>
<pre><code class="language-solidity">event ReceivedIncome(address indexed sender, uint256 assets, uint256 projectId);
</code></pre>
<h3 id="projectregistered"><a class="header" href="#projectregistered">ProjectRegistered</a></h3>
<pre><code class="language-solidity">event ProjectRegistered(uint256 indexed project);
</code></pre>
<h2 id="errors"><a class="header" href="#errors">Errors</a></h2>
<h3 id="insufficientasset"><a class="header" href="#insufficientasset">InsufficientAsset</a></h3>
<pre><code class="language-solidity">error InsufficientAsset();
</code></pre>
<h3 id="insufficientliquidity"><a class="header" href="#insufficientliquidity">InsufficientLiquidity</a></h3>
<pre><code class="language-solidity">error InsufficientLiquidity();
</code></pre>
<h3 id="insufficientbalance"><a class="header" href="#insufficientbalance">InsufficientBalance</a></h3>
<pre><code class="language-solidity">error InsufficientBalance();
</code></pre>
<h3 id="insufficientallowance"><a class="header" href="#insufficientallowance">InsufficientAllowance</a></h3>
<pre><code class="language-solidity">error InsufficientAllowance();
</code></pre>
<h3 id="unknowntoken"><a class="header" href="#unknowntoken">UnknownToken</a></h3>
<pre><code class="language-solidity">error UnknownToken();
</code></pre>
<h3 id="zeroshares"><a class="header" href="#zeroshares">ZeroShares</a></h3>
<pre><code class="language-solidity">error ZeroShares();
</code></pre>
<h3 id="zeroamount"><a class="header" href="#zeroamount">ZeroAmount</a></h3>
<pre><code class="language-solidity">error ZeroAmount();
</code></pre>
<h3 id="zeroaddress"><a class="header" href="#zeroaddress">ZeroAddress</a></h3>
<pre><code class="language-solidity">error ZeroAddress();
</code></pre>
<h3 id="overflow"><a class="header" href="#overflow">Overflow</a></h3>
<pre><code class="language-solidity">error Overflow();
</code></pre>
<h3 id="identicaladdresses"><a class="header" href="#identicaladdresses">IdenticalAddresses</a></h3>
<pre><code class="language-solidity">error IdenticalAddresses();
</code></pre>
<h3 id="insufficientlockuptime"><a class="header" href="#insufficientlockuptime">InsufficientLockupTime</a></h3>
<pre><code class="language-solidity">error InsufficientLockupTime();
</code></pre>
<h3 id="unauthorized"><a class="header" href="#unauthorized">Unauthorized</a></h3>
<pre><code class="language-solidity">error Unauthorized();
</code></pre>
<h3 id="notproject"><a class="header" href="#notproject">NotProject</a></h3>
<pre><code class="language-solidity">error NotProject();
</code></pre>
<h2 id="structs"><a class="header" href="#structs">Structs</a></h2>
<h3 id="project"><a class="header" href="#project">Project</a></h3>
<pre><code class="language-solidity">struct Project {
    bool isActive;
    bool isCompleted;
    address admin;
    uint128 totalAssetsSupplied;
    uint128 totalAssetsRepaid;
    string projectName;
    string masterAgreement;
}
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../src/interfaces/IL2Pool.sol/interface.IL2Pool.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../src/interfaces/IL2Pool.sol/interface.IL2Pool.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../../solidity.min.js"></script>


    </div>
    </body>
</html>
